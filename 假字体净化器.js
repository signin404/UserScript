// ==UserScript==
// @name         å‡å­—ä½“å‡€åŒ–å™¨
// @description  å°†Unicodeå‡å­—ä½“æ›¿æ¢ä¸ºæ ‡å‡†ASCIIå­—ç¬¦
// @namespace    http://tampermonkey.net/
// @match        *://*/*
// @run-at       document-start
// @version      2.4
// @author       Gemini
// @license      GPLv3
// ==/UserScript==

(function() {
    'use strict';

    // æ˜ å°„è¡¨ï¼šåŒ…å«å„ç§Unicode "å‡å­—ä½“" åˆ°æ ‡å‡†å­—ç¬¦çš„è½¬æ¢
    const charMap = {
        // --- å­—æ¯ ---
        // ç²—ä½“ (Bold)
        'ğ€': 'A', 'ğ': 'B', 'ğ‚': 'C', 'ğƒ': 'D', 'ğ„': 'E', 'ğ…': 'F', 'ğ†': 'G', 'ğ‡': 'H', 'ğˆ': 'I', 'ğ‰': 'J', 'ğŠ': 'K', 'ğ‹': 'L', 'ğŒ': 'M', 'ğ': 'N', 'ğ': 'O', 'ğ': 'P', 'ğ': 'Q', 'ğ‘': 'R', 'ğ’': 'S', 'ğ“': 'T', 'ğ”': 'U', 'ğ•': 'V', 'ğ–': 'W', 'ğ—': 'X', 'ğ˜': 'Y', 'ğ™': 'Z',
        'ğš': 'a', 'ğ›': 'b', 'ğœ': 'c', 'ğ': 'd', 'ğ': 'e', 'ğŸ': 'f', 'ğ ': 'g', 'ğ¡': 'h', 'ğ¢': 'i', 'ğ£': 'j', 'ğ¤': 'k', 'ğ¥': 'l', 'ğ¦': 'm', 'ğ§': 'n', 'ğ¨': 'o', 'ğ©': 'p', 'ğª': 'q', 'ğ«': 'r', 'ğ¬': 's', 'ğ­': 't', 'ğ®': 'u', 'ğ¯': 'v', 'ğ°': 'w', 'ğ±': 'x', 'ğ²': 'y', 'ğ³': 'z',
        // æ–œä½“ (Italic)
        'ğ´': 'A', 'ğµ': 'B', 'ğ¶': 'C', 'ğ·': 'D', 'ğ¸': 'E', 'ğ¹': 'F', 'ğº': 'G', 'ğ»': 'H', 'ğ¼': 'I', 'ğ½': 'J', 'ğ¾': 'K', 'ğ¿': 'L', 'ğ‘€': 'M', 'ğ‘': 'N', 'ğ‘‚': 'O', 'ğ‘ƒ': 'P', 'ğ‘„': 'Q', 'ğ‘…': 'R', 'ğ‘†': 'S', 'ğ‘‡': 'T', 'ğ‘ˆ': 'U', 'ğ‘‰': 'V', 'ğ‘Š': 'W', 'ğ‘‹': 'X', 'ğ‘Œ': 'Y', 'ğ‘': 'Z',
        'ğ‘': 'a', 'ğ‘': 'b', 'ğ‘': 'c', 'ğ‘‘': 'd', 'ğ‘’': 'e', 'ğ‘“': 'f', 'ğ‘”': 'g', 'â„': 'h', 'ğ‘–': 'i', 'ğ‘—': 'j', 'ğ‘˜': 'k', 'ğ‘™': 'l', 'ğ‘š': 'm', 'ğ‘›': 'n', 'ğ‘œ': 'o', 'ğ‘': 'p', 'ğ‘': 'q', 'ğ‘Ÿ': 'r', 'ğ‘ ': 's', 'ğ‘¡': 't', 'ğ‘¢': 'u', 'ğ‘£': 'v', 'ğ‘¤': 'w', 'ğ‘¥': 'x', 'ğ‘¦': 'y', 'ğ‘§': 'z',
        // ç²—æ–œä½“ (Bold Italic)
        'ğ‘¨': 'A', 'ğ‘©': 'B', 'ğ‘ª': 'C', 'ğ‘«': 'D', 'ğ‘¬': 'E', 'ğ‘­': 'F', 'ğ‘®': 'G', 'ğ‘¯': 'H', 'ğ‘°': 'I', 'ğ‘±': 'J', 'ğ‘²': 'K', 'ğ‘³': 'L', 'ğ‘´': 'M', 'ğ‘µ': 'N', 'ğ‘¶': 'O', 'ğ‘·': 'P', 'ğ‘¸': 'Q', 'ğ‘¹': 'R', 'ğ‘º': 'S', 'ğ‘»': 'T', 'ğ‘¼': 'U', 'ğ‘½': 'V', 'ğ‘¾': 'W', 'ğ‘¿': 'X', 'ğ’€': 'Y', 'ğ’': 'Z',
        'ğ’‚': 'a', 'ğ’ƒ': 'b', 'ğ’„': 'c', 'ğ’…': 'd', 'ğ’†': 'e', 'ğ’‡': 'f', 'ğ’ˆ': 'g', 'ğ’‰': 'h', 'ğ’Š': 'i', 'ğ’‹': 'j', 'ğ’Œ': 'k', 'ğ’': 'l', 'ğ’': 'm', 'ğ’': 'n', 'ğ’': 'o', 'ğ’‘': 'p', 'ğ’’': 'q', 'ğ’“': 'r', 'ğ’”': 's', 'ğ’•': 't', 'ğ’–': 'u', 'ğ’—': 'v', 'ğ’˜': 'w', 'ğ’™': 'x', 'ğ’š': 'y', 'ğ’›': 'z',
        // èŠ±ä½“ (Script)
        'ğ’œ': 'A', 'â„¬': 'B', 'ğ’': 'C', 'ğ’Ÿ': 'D', 'â„°': 'E', 'â„±': 'F', 'ğ’¢': 'G', 'â„‹': 'H', 'â„': 'I', 'ğ’¥': 'J', 'ğ’¦': 'K', 'â„’': 'L', 'â„³': 'M', 'ğ’©': 'N', 'ğ’ª': 'O', 'ğ’«': 'P', 'ğ’¬': 'Q', 'â„›': 'R', 'ğ’®': 'S', 'ğ’¯': 'T', 'ğ’°': 'U', 'ğ’±': 'V', 'ğ’²': 'W', 'ğ’³': 'X', 'ğ’´': 'Y', 'ğ’µ': 'Z',
        'ğ’¶': 'a', 'ğ’·': 'b', 'ğ’¸': 'c', 'ğ’¹': 'd', 'â„¯': 'e', 'ğ’»': 'f', 'â„Š': 'g', 'ğ’½': 'h', 'ğ’¾': 'i', 'ğ’¿': 'j', 'ğ“€': 'k', 'ğ“': 'l', 'ğ“‚': 'm', 'ğ“ƒ': 'n', 'â„´': 'o', 'ğ“…': 'p', 'ğ“†': 'q', 'ğ“‡': 'r', 'ğ“ˆ': 's', 'ğ“‰': 't', 'ğ“Š': 'u', 'ğ“‹': 'v', 'ğ“Œ': 'w', 'ğ“': 'x', 'ğ“': 'y', 'ğ“': 'z',
        // ç²—èŠ±ä½“ (Bold Script)
        'ğ“': 'A', 'ğ“‘': 'B', 'ğ“’': 'C', 'ğ““': 'D', 'ğ“”': 'E', 'ğ“•': 'F', 'ğ“–': 'G', 'ğ“—': 'H', 'ğ“˜': 'I', 'ğ“™': 'J', 'ğ“š': 'K', 'ğ“›': 'L', 'ğ“œ': 'M', 'ğ“': 'N', 'ğ“': 'O', 'ğ“Ÿ': 'P', 'ğ“ ': 'Q', 'ğ“¡': 'R', 'ğ“¢': 'S', 'ğ“£': 'T', 'ğ“¤': 'U', 'ğ“¥': 'V', 'ğ“¦': 'W', 'ğ“§': 'X', 'ğ“¨': 'Y', 'ğ“©': 'Z',
        'ğ“ª': 'a', 'ğ“«': 'b', 'ğ“¬': 'c', 'ğ“­': 'd', 'ğ“®': 'e', 'ğ“¯': 'f', 'ğ“°': 'g', 'ğ“±': 'h', 'ğ“²': 'i', 'ğ“³': 'j', 'ğ“´': 'k', 'ğ“µ': 'l', 'ğ“¶': 'm', 'ğ“·': 'n', 'ğ“¸': 'o', 'ğ“¹': 'p', 'ğ“†': 'q', 'ğ“»': 'r', 'ğ“¼': 's', 'ğ“½': 't', 'ğ“¾': 'u', 'ğ“¿': 'v', 'ğ”€': 'w', 'ğ”': 'x', 'ğ”‚': 'y', 'ğ”ƒ': 'z',
        // æ— è¡¬çº¿ç²—ä½“ (Sans-Serif Bold)
        'ğ—”': 'A', 'ğ—•': 'B', 'ğ—–': 'C', 'ğ——': 'D', 'ğ—˜': 'E', 'ğ—™': 'F', 'ğ—š': 'G', 'ğ—›': 'H', 'ğ—œ': 'I', 'ğ—': 'J', 'ğ—': 'K', 'ğ—Ÿ': 'L', 'ğ— ': 'M', 'ğ—¡': 'N', 'ğ—¢': 'O', 'ğ—£': 'P', 'ğ—¤': 'Q', 'ğ—¥': 'R', 'ğ—¦': 'S', 'ğ—§': 'T', 'ğ—¨': 'U', 'ğ—©': 'V', 'ğ—ª': 'W', 'ğ—«': 'X', 'ğ—¬': 'Y', 'ğ—­': 'Z',
        'ğ—®': 'a', 'ğ—¯': 'b', 'ğ—°': 'c', 'ğ—±': 'd', 'ğ—²': 'e', 'ğ—³': 'f', 'ğ—´': 'g', 'ğ—µ': 'h', 'ğ—¶': 'i', 'ğ—·': 'j', 'ğ—¸': 'k', 'ğ—¹': 'l', 'ğ—º': 'm', 'ğ—»': 'n', 'ğ—¼': 'o', 'ğ—½': 'p', 'ğ—¾': 'q', 'ğ—¿': 'r', 'ğ˜€': 's', 'ğ˜': 't', 'ğ˜‚': 'u', 'ğ˜ƒ': 'v', 'ğ˜„': 'w', 'ğ˜…': 'x', 'ğ˜†': 'y', 'ğ˜‡': 'z',
        // æ— è¡¬çº¿ç²—æ–œä½“ (Sans-Serif Bold Italic)
        'ğ˜¼': 'A', 'ğ˜½': 'B', 'ğ˜¾': 'C', 'ğ˜¿': 'D', 'ğ™€': 'E', 'ğ™': 'F', 'ğ™‚': 'G', 'ğ™ƒ': 'H', 'ğ™„': 'I', 'ğ™…': 'J', 'ğ™†': 'K', 'ğ™‡': 'L', 'ğ™ˆ': 'M', 'ğ™‰': 'N', 'ğ™Š': 'O', 'ğ™‹': 'P', 'ğ™Œ': 'Q', 'ğ™': 'R', 'ğ™': 'S', 'ğ™': 'T', 'ğ™': 'U', 'ğ™‘': 'V', 'ğ™’': 'W', 'ğ™“': 'X', 'ğ™”': 'Y', 'ğ™•': 'Z',
        'ğ™–': 'a', 'ğ™—': 'b', 'ğ™˜': 'c', 'ğ™™': 'd', 'ğ™š': 'e', 'ğ™›': 'f', 'ğ™œ': 'g', 'ğ™': 'h', 'ğ™': 'i', 'ğ™Ÿ': 'j', 'ğ™ ': 'k', 'ğ™¡': 'l', 'ğ™¢': 'm', 'ğ™£': 'n', 'ğ™¤': 'o', 'ğ™¥': 'p', 'ğ™¦': 'q', 'ğ™§': 'r', 'ğ™¨': 's', 'ğ™©': 't', 'ğ™ª': 'u', 'ğ™«': 'v', 'ğ™¬': 'w', 'ğ™­': 'x', 'ğ™®': 'y', 'ğ™¯': 'z',
        // å“¥ç‰¹ä½“ (Fraktur)
        'ğ”„': 'A', 'ğ”…': 'B', 'â„­': 'C', 'ğ”‡': 'D', 'ğ”ˆ': 'E', 'ğ”‰': 'F', 'ğ”Š': 'G', 'â„Œ': 'H', 'â„‘': 'I', 'ğ”': 'J', 'ğ”': 'K', 'ğ”': 'L', 'ğ”': 'M', 'ğ”‘': 'N', 'ğ”’': 'O', 'ğ”“': 'P', 'ğ””': 'Q', 'â„œ': 'R', 'ğ”–': 'S', 'ğ”—': 'T', 'ğ”˜': 'U', 'ğ”™': 'V', 'ğ”š': 'W', 'ğ”›': 'X', 'ğ”œ': 'Y', 'â„¨': 'Z',
        'ğ”': 'a', 'ğ”Ÿ': 'b', 'ğ” ': 'c', 'ğ”¡': 'd', 'ğ”¢': 'e', 'ğ”£': 'f', 'ğ”¤': 'g', 'ğ”¥': 'h', 'ğ”¦': 'i', 'ğ”§': 'j', 'ğ”¨': 'k', 'ğ”©': 'l', 'ğ”ª': 'm', 'ğ”«': 'n', 'ğ”¬': 'o', 'ğ”­': 'p', 'ğ”®': 'q', 'ğ”¯': 'r', 'ğ”°': 's', 'ğ”±': 't', 'ğ”²': 'u', 'ğ”³': 'v', 'ğ”´': 'w', 'ğ”µ': 'x', 'ğ”¶': 'y', 'ğ”·': 'z',
        // ç²—ä½“å“¥ç‰¹ä½“ (Bold Fraktur)
        'ğ•¬': 'A', 'ğ•­': 'B', 'ğ•®': 'C', 'ğ•¯': 'D', 'ğ•°': 'E', 'ğ•±': 'F', 'ğ•²': 'G', 'ğ•³': 'H', 'ğ•´': 'I', 'ğ•µ': 'J', 'ğ•¶': 'K', 'ğ•·': 'L', 'ğ•¸': 'M', 'ğ•¹': 'N', 'ğ•º': 'O', 'ğ•»': 'P', 'ğ•¼': 'Q', 'ğ•½': 'R', 'ğ•¾': 'S', 'ğ•¿': 'T', 'ğ–€': 'U', 'ğ–': 'V', 'ğ–‚': 'W', 'ğ–ƒ': 'X', 'ğ–„': 'Y', 'ğ–…': 'Z',
        'ğ–†': 'a', 'ğ–‡': 'b', 'ğ–ˆ': 'c', 'ğ–‰': 'd', 'ğ–Š': 'e', 'ğ–‹': 'f', 'ğ–Œ': 'g', 'ğ–': 'h', 'ğ–': 'i', 'ğ–': 'j', 'ğ–': 'k', 'ğ–‘': 'l', 'ğ–’': 'm', 'ğ–“': 'n', 'ğ–”': 'o', 'ğ–•': 'p', 'ğ––': 'q', 'ğ–—': 'r', 'ğ–˜': 's', 'ğ–™': 't', 'ğ–š': 'u', 'ğ–›': 'v', 'ğ–œ': 'w', 'ğ–': 'x', 'ğ–': 'y', 'ğ–Ÿ': 'z',
        // åŒçº¿ä½“ (Double-Struck)
        'ğ”¸': 'A', 'ğ”¹': 'B', 'â„‚': 'C', 'ğ”»': 'D', 'ğ”¼': 'E', 'ğ”½': 'F', 'ğ”¾': 'G', 'â„': 'H', 'ğ•€': 'I', 'ğ•': 'J', 'ğ•‚': 'K', 'ğ•ƒ': 'L', 'ğ•„': 'M', 'â„•': 'N', 'ğ•†': 'O', 'â„™': 'P', 'â„š': 'Q', 'â„': 'R', 'ğ•Š': 'S', 'ğ•‹': 'T', 'ğ•Œ': 'U', 'ğ•': 'V', 'ğ•': 'W', 'ğ•': 'X', 'ğ•': 'Y', 'â„¤': 'Z',
        'ğ•’': 'a', 'ğ•“': 'b', 'ğ•”': 'c', 'ğ••': 'd', 'ğ•–': 'e', 'ğ•—': 'f', 'ğ•˜': 'g', 'ğ•™': 'h', 'ğ•š': 'i', 'ğ•›': 'j', 'ğ•œ': 'k', 'ğ•': 'l', 'ğ•': 'm', 'ğ•Ÿ': 'n', 'ğ• ': 'o', 'ğ•¡': 'p', 'ğ•¢': 'q', 'ğ•£': 'r', 'ğ•¤': 's', 'ğ•¥': 't', 'ğ•¦': 'u', 'ğ•§': 'v', 'ğ•¨': 'w', 'ğ•©': 'x', 'ğ•ª': 'y', 'ğ•«': 'z',
        // ç­‰å®½ (Monospace)
        'ğ™°': 'A', 'ğ™±': 'B', 'ğ™²': 'C', 'ğ™³': 'D', 'ğ™´': 'E', 'ğ™µ': 'F', 'ğ™¶': 'G', 'ğ™·': 'H', 'ğ™¸': 'I', 'ğ™¹': 'J', 'ğ™º': 'K', 'ğ™»': 'L', 'ğ™¼': 'M', 'ğ™½': 'N', 'ğ™¾': 'O', 'ğ™¿': 'P', 'ğš€': 'Q', 'ğš': 'R', 'ğš‚': 'S', 'ğšƒ': 'T', 'ğš„': 'U', 'ğš…': 'V', 'ğš†': 'W', 'ğš‡': 'X', 'ğšˆ': 'Y', 'ğš‰': 'Z',
        'ğšŠ': 'a', 'ğš‹': 'b', 'ğšŒ': 'c', 'ğš': 'd', 'ğš': 'e', 'ğš': 'f', 'ğš': 'g', 'ğš‘': 'h', 'ğš’': 'i', 'ğš“': 'j', 'ğš”': 'k', 'ğš•': 'l', 'ğš–': 'm', 'ğš—': 'n', 'ğš˜': 'o', 'ğš™': 'p', 'ğšš': 'q', 'ğš›': 'r', 'ğšœ': 's', 'ğš': 't', 'ğš': 'u', 'ğšŸ': 'v', 'ğš ': 'w', 'ğš¡': 'x', 'ğš¢': 'y', 'ğš£': 'z',

        // --- æ•°å­— ---
        // ç²—ä½“ (Bold)
        'ğŸ': '0', 'ğŸ': '1', 'ğŸ': '2', 'ğŸ‘': '3', 'ğŸ’': '4', 'ğŸ“': '5', 'ğŸ”': '6', 'ğŸ•': '7', 'ğŸ–': '8', 'ğŸ—': '9',
        // åŒçº¿ä½“ (Double-Struck)
        'ğŸ˜': '0', 'ğŸ™': '1', 'ğŸš': '2', 'ğŸ›': '3', 'ğŸœ': '4', 'ğŸ': '5', 'ğŸ': '6', 'ğŸŸ': '7', 'ğŸ ': '8', 'ğŸ¡': '9',
        // ç­‰å®½ (Monospace)
        'ğŸ¶': '0', 'ğŸ·': '1', 'ğŸ¸': '2', 'ğŸ¹': '3', 'ğŸº': '4', 'ğŸ»': '5', 'ğŸ¼': '6', 'ğŸ½': '7', 'ğŸ¾': '8', 'ğŸ¿': '9',
    };

    const regex = new RegExp(Object.keys(charMap).join('|'), 'g');
    const replacer = (match) => charMap[match];

    const normalizeText = (text) => text.replace(regex, replacer);

    // æ ¸å¿ƒå¤„ç†å‡½æ•°ï¼šç°åœ¨åªå¤„ç†å•ä¸ªèŠ‚ç‚¹
    const processNode = (node) => {
        // åªå¤„ç†æ–‡æœ¬èŠ‚ç‚¹
        if (node.nodeType === Node.TEXT_NODE) {
            const text = node.nodeValue;
            const newText = normalizeText(text);
            if (newText !== text) {
                node.nodeValue = newText;
            }
        }
        // å¦‚æœæ˜¯å…ƒç´ èŠ‚ç‚¹ éå†å…¶æ‰€æœ‰å­æ–‡æœ¬èŠ‚ç‚¹
        else if (node.nodeType === Node.ELEMENT_NODE) {
             // å¿½ç•¥è„šæœ¬å’Œæ ·å¼æ ‡ç­¾ é¿å…ç ´åé¡µé¢åŠŸèƒ½
            if (node.tagName === 'SCRIPT' || node.tagName === 'STYLE' || node.isContentEditable) return;

            const walker = document.createTreeWalker(node, NodeFilter.SHOW_TEXT);
            let currentNode;
            while (currentNode = walker.nextNode()) {
                processNode(currentNode);
            }
        }
    };

    // åˆ›å»ºä¸€ä¸ª MutationObserver æ¥ç›‘è§†DOMå˜åŒ–
    const observer = new MutationObserver((mutations) => {
        for (const mutation of mutations) {
            // å½“æœ‰æ–°èŠ‚ç‚¹æ·»åŠ æ—¶
            if (mutation.type === 'childList') {
                for (const node of mutation.addedNodes) {
                    processNode(node);
                }
            }
            // å½“æ–‡æœ¬èŠ‚ç‚¹çš„å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ (å…³é”®ï¼è¿™èƒ½æ•è·Reactç­‰æ¡†æ¶çš„æ›´æ–°)
            else if (mutation.type === 'characterData') {
                processNode(mutation.target);
            }
        }
    });

    // åˆå§‹æ‰§è¡Œï¼šå¤„ç†é¡µé¢åŠ è½½æ—¶å·²å­˜åœ¨çš„å†…å®¹
    // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿åœ¨é¡µé¢é¦–æ¬¡æ¸²æŸ“åæ‰§è¡Œ
    window.requestAnimationFrame(() => {
        if (document.body) {
            processNode(document.body);
        }
    });

    // å¼€å§‹ç›‘è§†æ•´ä¸ªæ–‡æ¡£çš„å˜åŒ–
    // é…ç½® observer ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–ã€å­æ ‘å˜åŒ–ã€ä»¥åŠæ–‡æœ¬å†…å®¹å˜åŒ–
    observer.observe(document.documentElement, {
        childList: true,
        subtree: true,
        characterData: true
    });

})();